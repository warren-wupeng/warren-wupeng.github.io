<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="code, architecture, engineering">
<meta property="og:type" content="blog">
<meta property="og:title" content="Warren&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Warren&#39;s Blog">
<meta property="og:description" content="code, architecture, engineering">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Warren Wu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Warren's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Warren's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Warren Wu</p>
  <div class="site-description" itemprop="description">code, architecture, engineering</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/02/19/%E4%BB%8E%E7%BA%A6%E6%9D%9F%E8%A7%86%E8%A7%92%E7%9C%8B%E5%BE%85%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/19/%E4%BB%8E%E7%BA%A6%E6%9D%9F%E8%A7%86%E8%A7%92%E7%9C%8B%E5%BE%85%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/" class="post-title-link" itemprop="url">从约束视角看待后端架构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-02-19 21:59:44 / Modified: 22:01:34" itemprop="dateCreated datePublished" datetime="2024-02-19T21:59:44+08:00">2024-02-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="pdf-container" data-target="https://github.com/warren-wupeng/warren-wupeng.github.io/blob/main/backend-workshop-en%2Bzh.pdf" data-height="500px"></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/02/19/stream-respose-with-fastapi-and-langchain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/19/stream-respose-with-fastapi-and-langchain/" class="post-title-link" itemprop="url">stream respose with fastapi and langchain</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-02-19 15:55:44 / Modified: 15:59:37" itemprop="dateCreated datePublished" datetime="2024-02-19T15:55:44+08:00">2024-02-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>以下代码是一个使用FastAPI和Langchain的异步流处理的例子。它创建了一个FastAPI应用，该应用有一个POST路由&#x2F;stream，该路由接收一个消息，然后使用Langchain的ChatOpenAI模型生成一个响应流。<br>完整实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> AsyncIterable, Awaitable</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> StreamingResponse</span><br><span class="line"><span class="keyword">from</span> langchain.callbacks <span class="keyword">import</span> AsyncIteratorCallbackHandler</span><br><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> HumanMessage</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># Two ways to load env variables</span></span><br><span class="line"><span class="comment"># 1.load env variables from .env file</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.manually set env variables</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;OPENAI_API_KEY&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    os.environ[<span class="string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">send_message</span>(<span class="params">message: <span class="built_in">str</span></span>) -&gt; AsyncIterable[<span class="built_in">str</span>]:</span><br><span class="line">    callback = AsyncIteratorCallbackHandler()</span><br><span class="line">    model = ChatOpenAI(</span><br><span class="line">        streaming=<span class="literal">True</span>,</span><br><span class="line">        verbose=<span class="literal">True</span>,</span><br><span class="line">        callbacks=[callback],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">wrap_done</span>(<span class="params">fn: Awaitable, event: asyncio.Event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Wrap an awaitable with a event to signal when it&#x27;s done or an exception is raised.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">await</span> fn</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Caught exception: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># Signal the aiter to stop.</span></span><br><span class="line">            event.<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Begin a task that runs in the background.</span></span><br><span class="line">    task = asyncio.create_task(wrap_done(</span><br><span class="line">        model.agenerate(messages=[[HumanMessage(content=message)]]),</span><br><span class="line">        callback.done),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> token <span class="keyword">in</span> callback.aiter():</span><br><span class="line">        <span class="comment"># Use server-sent-events to stream the response</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="string">f&quot;data: <span class="subst">&#123;token&#125;</span>\n\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> task</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StreamRequest</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Request body for streaming.&quot;&quot;&quot;</span></span><br><span class="line">    message: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/stream&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream</span>(<span class="params">body: StreamRequest</span>):</span><br><span class="line">    <span class="keyword">return</span> StreamingResponse(send_message(body.message), media_type=<span class="string">&quot;text/event-stream&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>, app=app)</span><br></pre></td></tr></table></figure>

<p>以下是代码的主要部分的解释：</p>
<p>send_message函数：这是一个异步生成器函数，它接收一个消息，然后使用Langchain的ChatOpenAI模型生成一个响应流。这个函数使用了一个AsyncIteratorCallbackHandler来处理模型的回调，并使用一个后台任务来运行模型的生成器函数。每当生成器产生一个新的令牌时，这个函数就会产生一个新的服务器发送的事件。</p>
<p>StreamRequest类：这是一个Pydantic模型，用于验证流请求的请求体。它只有一个字段message，表示要发送的消息。</p>
<p>&#x2F;stream路由：这是一个POST路由，它接收一个StreamRequest对象，然后调用send_message函数来生成一个响应流。它使用StreamingResponse来返回这个流，媒体类型设置为text&#x2F;event-stream，这是服务器发送的事件的标准媒体类型。</p>
<p>主函数：如果这个脚本作为主程序运行，它将使用uvicorn来启动FastAPI应用。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/01/AWS-db-proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/01/AWS-db-proxy/" class="post-title-link" itemprop="url">AWS db proxy</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-11-01 13:19:05 / Modified: 14:59:59" itemprop="dateCreated datePublished" datetime="2023-11-01T13:19:05+08:00">2023-11-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>concepts</p>
<ul>
<li><p>connection pool</p>
</li>
<li><p>multiplexing</p>
</li>
<li><p>borrowing</p>
</li>
<li><p>pinning</p>
</li>
<li><p>target group</p>
</li>
<li><p>targets</p>
</li>
<li><p>transaction level reuse<br>若不使用autocommit,只有在rollback或者commit时才会复用连接</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/13/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/13/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">MySQL数据库索引</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-13 09:28:25" itemprop="dateCreated datePublished" datetime="2023-09-13T09:28:25+08:00">2023-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-14 21:43:08" itemprop="dateModified" datetime="2023-09-14T21:43:08+08:00">2023-09-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>青年：为什么需要索引?</p>
<p>大师：这是为了加速数据查找.</p>
<p>青年：嗯。。</p>
<p>大师：没懂？打个比方，你查字典是怎么查的？你会从头到尾一页一页翻吗？不，你会按拼音，偏旁，或者笔画，找到字所对应的页码，然后再直接翻到对应的页码上.</p>
<p>青年：有点懂了</p>
<p>大师：你经常用MySQL，你知道MySQL使用什么数据结构吗？</p>
<p>青年：好像是叫B+树，但为啥叫B+树啊？</p>
<p>大师：B+树是一种改进的B树。B树的B是Balanced的缩写意思，Balanced Tree，就是平衡树。平衡意思是它会保持树的左右两边节点数量差距尽量小。</p>
<p>青年：B+树相对B树改进在哪里呢？</p>
<p>大师：问得好。<br>一是在于所有叶子节点位于同一层，并且并且通过指针连接成一个有序链表<br>二是非叶子节点不存储数据，只存储索引信息。<br>三是B+树每个节点可以存储多个关键字，这些关键字按生序排列</p>
<p>青年：为什么要做这些改进，有啥作用？</p>
<p>大师：是这样的。<br>第一，叶子结点连成链表，是为了让范围查询更高效。<br>第二，非叶子结点不存数据，这样索引就更适合放到内存里，<br>第三，节点可以存储多个关键字，那么树的高度就会相对低一点，查询的耗时跟树的高度是相关的，树的高度越低，查询性能就越好</p>
<p>青年：原来如此。但是我知道这些有什么用呢？</p>
<p>大师：别急呀。作为程序员你经常需要优化SQL的性能。要优化性能，理解B+树的特点是关键所在。<br>你听我慢慢道来。MySQL数据表是一颗使用主键搭建起来的B+树。叶子结点上存放着表的所有行。<br>其他索引也是B+树，只不过叶子结点上存放的是主键。</p>
<p>大师：当一个query使用了索引时，往往先是从索引找到主键，再根据主键去主表查具体数据行<br>根据主键去主表查具体数据行的这个操作叫做回表，它往往很慢，因为主表上的具体数据行存储再磁盘上而不是内存里。<br>磁盘的一次随机寻址大约1千万纳秒，而一次内存寻址只需要100纳秒，相差十万倍。<br>所以回表是要尽量避免的。如何避免呢，当query所需要查的列就在索引中时，就不需要回表了。这样的请求就会很高效</p>
<p>所以SQL优化的关键点就是</p>
<ol>
<li>SQL只查所需要的列</li>
<li>针对对高频的查询，设计索引，使得所需要的列全部都在索引中</li>
</ol>
<p>青年：现在我明白了，为啥经常说禁止使用select *。原来是为了方便发现高频请求，以便设计索引。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/10/%E5%A6%82%E4%BD%95%E5%81%9A%E9%9C%80%E6%B1%82%E6%94%B6%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/10/%E5%A6%82%E4%BD%95%E5%81%9A%E9%9C%80%E6%B1%82%E6%94%B6%E9%9B%86/" class="post-title-link" itemprop="url">如何做需求收集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-09-10 21:06:16 / Modified: 22:43:43" itemprop="dateCreated datePublished" datetime="2023-09-10T21:06:16+08:00">2023-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>做需求收集有很多方法论，我个人认可的有以下这些</p>
<ul>
<li>用例 （Use Case)</li>
<li>用户故事 (User Story)</li>
<li>用户故事地图 (User Story Mapping)</li>
<li>影响地图 (Impact Mapping)</li>
</ul>
<h1 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h1><p>用例是一种识别、澄清和组织系统需求的方法论。它一般配合UML图一起使用，是一种有效的需求沟通工具。它是最早出现的需求收集分析的方法论。<br>以下是一个用例图的示例</p>
<pre class="mermaid">
graph LR
A[Actor] --&gt; B((Use Case 1))
A --&gt; C((Use Case 2))
B --&gt; D{System}
C --&gt; D
D --&gt; E[Actor]
D --&gt; F[Actor]
</pre>


<p>用例技术非常有用，但是也存在局限性<br>使用use case收集分析需求的局限性包括以下几点：</p>
<ol>
<li><p>复杂性：使用use case方法需要详细描述系统的各种功能和交互，特别是在大型系统中，可能会导致大量的use case，难以管理和维护。</p>
</li>
<li><p>语言障碍：use case通常使用专业的技术术语和领域特定的语言，可能会导致与非技术人员的沟通困难。</p>
</li>
<li><p>详细度：use case需要详细描述系统的各种功能和交互，可能会导致过度关注细节而忽视整体需求。</p>
</li>
<li><p>可变性：use case通常是一次性的文档，一旦编写完成，很难进行修改和更新，随着需求的变化，可能会导致use case的失效。</p>
</li>
</ol>
<p>为了解决use case方法的局限性，用户故事（user story）方法产生了。</p>
<h1 id="用户故事"><a href="#用户故事" class="headerlink" title="用户故事"></a>用户故事</h1><p>用户故事是一种简洁的描述用户需求的方法，强调与用户的对话和协作，而不是详细的文档。用户故事通常以如下形式描述：作为一个[角色]，我想要[目标]，以便[原因]。用户故事易于理解和记录，并且可以随时修改和更新，以适应需求的变化。此外，用户故事注重用户价值和用户体验，更侧重于用户需求的核心，而不是过度关注技术细节。因此，用户故事方法更加适用于敏捷开发等快速迭代的开发方法。</p>
<p>用户故事是敏捷开发中的一种需求描述技术，它用简洁的语言描述用户的需求和期望，以便开发团队能够更好地理解用户的需求并提供相应的解决方案。</p>
<p>用户故事通常包含以下要素：</p>
<ol>
<li><p>角色：用户故事描述了一个特定的用户或角色，例如“作为一名购物者”或“作为一名管理员”。</p>
</li>
<li><p>目标：用户故事描述了用户想要实现的目标或期望的结果，例如“我希望能够浏览商品并添加到购物车”或“我希望能够管理用户账户”。</p>
</li>
<li><p>动作：用户故事描述了用户采取的行动或操作，例如“我点击商品列表并浏览商品详情页面”或“我登录系统并更新用户信息”。</p>
</li>
<li><p>价值：用户故事描述了用户从实现目标中获得的价值或好处，例如“通过浏览商品并添加到购物车，我能够方便地购买所需的商品”或“通过管理用户账户，我可以更好地控制和保护我的个人信息”。</p>
</li>
</ol>
<p>用户故事通常以以下格式进行描述：作为一个[角色]，我想要[目标]，以便[价值]。开发团队可以根据用户故事来制定开发计划、优先级和测试方案，以确保最终产品符合用户的需求。</p>
<p>用户故事很棒，但是当你有成百上千个用户故事卡片，如何得到一个全局视图而不迷失在细节碎片中呢？如何为这些需求规划优先级呢？</p>
<p>为了解决这些问题，用户故事地图方法诞生了</p>
<h1 id="用户故事地图"><a href="#用户故事地图" class="headerlink" title="用户故事地图"></a>用户故事地图</h1><p>用户故事地图是一种工具，用于可视化和组织用户故事。它是一个二维图表，横轴表示用户故事的优先级，纵轴表示用户故事的主题或功能。用户故事地图按照用户的需求和优先级进行排列，使团队可以清晰地了解整个产品的功能和用户需求。</p>
<p>用户故事地图有以下几个用途：</p>
<ol>
<li><p>产品规划：用户故事地图可以帮助团队理解产品的整体功能和用户需求，以便更好地进行产品规划和决策。</p>
</li>
<li><p>优先级排序：通过用户故事地图，团队可以根据用户故事的优先级进行排序，确定哪些功能是最重要的，以便在开发过程中优先实现。</p>
</li>
<li><p>交流和沟通：用户故事地图可以作为一个视觉化的工具，帮助团队成员之间更好地交流和沟通，共享对产品功能和用户需求的理解。</p>
</li>
<li><p>追踪进展：通过用户故事地图，团队可以清晰地了解每个用户故事的状态和进展情况，以便及时调整和管理开发进度。</p>
</li>
</ol>
<p>用户故事地图很好，但它是一种相对重量级的规划，同时它并没有产品带来的商业价值给予足够的考虑。在增长黑客方法论的引领下，<br>一种更适应快迭代，更强调组织业务目标的方法论产生了</p>
<h1 id="影响力地图"><a href="#影响力地图" class="headerlink" title="影响力地图"></a>影响力地图</h1><p>影响力地图是一种轻量级的、协作的规划技术，适用于希望通过软件产品产生巨大影响的团队。它基于用户交互设计、结果驱动的规划和思维导图。影响力地图帮助交付团队和利益相关者可视化路线图，解释交付成果如何与用户需求相连接，并传达用户结果与更高级别组织目标之间的关系。</p>
<p>影响力地图包括以下要素：</p>
<ol>
<li><p>组织目标：描述了组织希望实现的最终目标或结果。</p>
</li>
<li><p>用户结果：描述了用户希望通过软件产品实现的具体结果或价值。</p>
</li>
<li><p>交付成果：描述了软件产品或功能的具体交付成果。</p>
</li>
<li><p>任务：描述了为实现交付成果而需要执行的具体任务或行动。</p>
</li>
</ol>
<pre class="mermaid">
graph LR
A[Organizational Goal] --&gt; B(User Outcome)
B --&gt; C(Deliverables)
C --&gt; D(Tasks)
</pre>


<p>总结<br>Use Case解决了清晰结构化描述需求的问题<br>User Story鼓励更多直接沟通，而不是通过文档沟通<br>User Story Mapping用于组织和规划大量的User Story<br>Impact Mapping强调业务目标的达成，只做对组织目标有益的事</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/%E9%AB%98%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/%E9%AB%98%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF/" class="post-title-link" itemprop="url">高并发问题解决基本思路</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 17:40:21" itemprop="dateCreated datePublished" datetime="2023-04-18T17:40:21+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-10 19:00:41" itemprop="dateModified" datetime="2023-09-10T19:00:41+08:00">2023-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="高并发问题解决基本思路"><a href="#高并发问题解决基本思路" class="headerlink" title="高并发问题解决基本思路"></a>高并发问题解决基本思路</h3><p>高并发问题的本质是有限的资源应对大量的请求</p>
<p>一般存在以下解决方向</p>
<ul>
<li><p>提高单位资源处理能力</p>
</li>
<li><p>增加资源</p>
</li>
<li><p>减少请求</p>
</li>
<li><p>提升处理速度</p>
</li>
</ul>
<p>以下分别讨论</p>
<p>提高单位资源处理能力</p>
<p>一般是采用更高性能的硬件或者更有针对性的硬件驱动。例如，使用固态硬盘替换机械硬盘以提升MySQL的处理能力</p>
<p>增加资源数量</p>
<p>单位资源的处理能力总是受制于物理极限的天花板，并且高性能硬件往往更加昂贵。因此通过增加资源数量来提升处理能力才是主流。这种方式也称为水平扩展。水平扩展要能实现并非无代价，代价就是无状态性。要满足无状态性通常有三种方案</p>
<ul>
<li><p>相同session路由到同一服务器</p>
</li>
<li><p>集中session存储</p>
</li>
<li><p>只用token存储session状态</p>
</li>
</ul>
<p>减少请求</p>
<p>减少请求一般有三种思路</p>
<ul>
<li><p>错峰</p>
</li>
<li><p>排队</p>
</li>
<li><p>限流</p>
</li>
</ul>
<p>处理速度</p>
<p>请求到一般处理流程是</p>
<p>前端访问-&gt;前置条件校验-&gt;业务处理-&gt;数据存储-&gt;结果响应返回。</p>
<p>根据经验，前置条件校验，业务处理，数据库IO是耗时关键</p>
<p>前置条件校验优化思路：</p>
<ul>
<li>缓存：前置条件校验一般是查询多，解决思路是使用更近的存储，代价是需要维护缓存一致性。</li>
</ul>
<p>业务处理优化思路：</p>
<ul>
<li><p>异步：有些处理并不是实时需要，如通知等，可以异步处理</p>
</li>
<li><p>并行：业务处理往往包含许多步骤，假如有些步骤没有依赖关系，可以并行处理，根据情况采用合适的并发模型。假如有依赖关系也可以尝试重新设计数据模型消除依赖。并行的代价是提升编码复杂性，需要小心设计避免资源竞争问题</p>
</li>
</ul>
<p>数据库IO优化思路：</p>
<ul>
<li><p>缓存：尽量使用缓存分担数据库查询压力</p>
</li>
<li><p>分散：例如MySQL主从模式分散请求流量</p>
</li>
<li><p>异步持久化：需要极致性能的场景不要直接磁盘访问。通过kafka之类的消息中间件异步持久化</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/12/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E9%A2%86%E5%9F%9F%E7%9A%84%E6%A0%87%E5%BA%A6%E5%AF%B9%E7%A7%B0%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/12/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E9%A2%86%E5%9F%9F%E7%9A%84%E6%A0%87%E5%BA%A6%E5%AF%B9%E7%A7%B0%E6%80%A7/" class="post-title-link" itemprop="url">计算机科学领域的标度对称性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-12-12 17:43:19" itemprop="dateCreated datePublished" datetime="2022-12-12T17:43:19+08:00">2022-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-10 19:01:26" itemprop="dateModified" datetime="2023-09-10T19:01:26+08:00">2023-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>计算机科学领域随处可见的标度对称性</p>
<p>什么是标度对称性</p>
<p>标度对称性是指一个系统的形态、规律等特征在尺度缩放变化时会保持不变。</p>
<p>例如，人体整体形态是“一分五”结构，即人体躯干分出双手双脚和头，而人的手和脚也是“一分五”结构</p>
<p>在计算机科学领域也随处可见这种特征。</p>
<p>例如</p>
<ul>
<li><p>多级存储结构：客户端-&gt;CDN-&gt;数据中心，API-&gt;缓存-&gt;数据库，CPU-&gt;Cache-&gt;内存。</p>
</li>
<li><p>事件总线：系统层的事件总线，应用编程中的事件驱动模式，CPU中的I&#x2F;O总线</p>
</li>
<li><p>派生数据模式：现代后端系统中，常常使用写入主数据库之后触发其他派生数据库的同步更新，例如Elasticsearch，MonogoDB。而MySQL数据库中，写入主表会触发索引、视图的更新。</p>
</li>
</ul>
<p>为什么会有这种特征？我认为有两种角度的解释。</p>
<p>第一种解释是，虽然计算机系统的规模一直在扩大，但本质都是在解决计算、存储、数据、通信的问题，所以问题系统规模扩大后，微观构件的组成规律在宏观层面仍然适用。</p>
<p>第二种解释是，计算机在历史上是自底向上发展起来的，早期硬件工程师的想法影响了做软件的工程师，软件工程师的想法又影响了设计企业级系统的架构师。现在我们常用的一些技术概念我猜都是来源于早期硬件设计，例如“写逻辑”的说法来源与逻辑电路。TCP中的多路复用概念可能来源于硬件中的multiplexer，前端和后端的概念可能是来源于编译系统，编译系统中前端指的是词法分析，语法分析，语义分析，后端指的是生成中间代码、优化、生成目标代码。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/11/05/%E6%88%91%E6%9C%80%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E4%B8%AA%E6%8A%80%E6%9C%AF%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/05/%E6%88%91%E6%9C%80%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E4%B8%AA%E6%8A%80%E6%9C%AF%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">我最喜欢的三个技术面试问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-05 17:55:21" itemprop="dateCreated datePublished" datetime="2022-11-05T17:55:21+08:00">2022-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-10 17:59:11" itemprop="dateModified" datetime="2023-09-10T17:59:11+08:00">2023-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="我最喜欢的三个技术面试问题"><a href="#我最喜欢的三个技术面试问题" class="headerlink" title="我最喜欢的三个技术面试问题"></a>我最喜欢的三个技术面试问题</h3><ul>
<li><p>一台关闭的个人电脑，从按下电源键到显示桌面之间发生了什么，请尽可能详细地描述</p>
</li>
<li><p>在个人电脑桌面，从双击chrome浏览器图标到显示浏览器默认页之间发生了什么，请尽可能详细地描述</p>
</li>
<li><p>在浏览器地址栏敲下baidu.com，从按下回车到看到百度首页之间发生了什么，请尽可能详细地描述</p>
</li>
</ul>
<p>第一个问题可以考察候选人对计算机体系结构理解，从硬件到操作系统，所有类型的工程师都适用。</p>
<p>第二个问题可以考察候选人对操作系统工作原理以及应用软件的理解，客户端开发工程师必问，对于移动端开发者还可以进一步替换成具体的Android或者iOS手机</p>
<p>第三个问题可以考察候选人对网络协议，后端服务，以及浏览器工作原理的理解，对于后端工程师可以进一步深挖对服务端的理解，对前端工程师可以进一步深挖对浏览器的理解</p>
<p>具体考察过程中，我会记下他回答中使用的技术概念，然后就他提出的技术概念继续深挖他对这个技术概念的理解，在他的回答中再记下他提到的新的技术概念，然后再深挖。用一种类似深度优先遍历的顺序让他遍历他的知识面。最终他能够正确解释的概念数量基本上就可以代表他的计算机基础知识水平</p>
<p>这几个问题的好处是能够比较量化地度量工程师的水平，大部分工程师基本都能说出一些大的过程步骤，但是真正基础扎实的工程师，能够更加深入解释各种技术细节。</p>
<p>我也会隔一段时间，问自己这些问题，看看我能解释的深入程度是否比上次更加深入了，以此检验我的知识是否有增长。这些问题就像七龙珠里外星人使用的战斗力侦测AR眼镜，让战斗力这种模糊概念可以做量化度量了。</p>
<p>坦白说，我觉得自己对计算机仍然知之甚少，要学的东西太多了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/11/04/%E4%BB%A3%E7%A0%81%E8%A6%81%E5%86%99%E4%B8%89%E9%81%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/04/%E4%BB%A3%E7%A0%81%E8%A6%81%E5%86%99%E4%B8%89%E9%81%8D/" class="post-title-link" itemprop="url">代码要写三遍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-04 17:56:40" itemprop="dateCreated datePublished" datetime="2022-11-04T17:56:40+08:00">2022-11-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-10 17:57:49" itemprop="dateModified" datetime="2023-09-10T17:57:49+08:00">2023-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="代码要写三遍"><a href="#代码要写三遍" class="headerlink" title="代码要写三遍"></a>代码要写三遍</h3><ul>
<li><p>第一遍，捕获需求</p>
</li>
<li><p>第二遍，优化设计</p>
</li>
<li><p>第三遍，调优性能</p>
</li>
</ul>
<p>“捕获”需求而不是“实现”需求</p>
<p>因为“实现”需求，假设的是需求都是确定的，但现实是，需求往往是在落地过程中得到反馈逐步确定的。而“捕获”需求，从一开始就接受需求是不确定的，往往在实现落地过程中会有细节变化。“捕获”需求要求工程师要从技术可行性，逻辑完备性，变更风险控制角度来审视需求，发现和确认遗漏捕获的细节。写技术方案应该被看作一种捕获需求的工具。同时要求工程师采用一种最小化反馈周期的做事方式。一个采用这种做事哲学的工程师，他懂得用最小可交付粒度来切割它的工作，如果是一个后端工程师，那么他应该按前端接口的粒度去交付，尽快获得来自前端和测试的反馈。而不是所有工作堆积到临近deadline才一起交付，然后面对一大波返工。</p>
<p>捕获需求阶段不过度考虑优化设计</p>
<p>这里讲的优化设计是指不改变功能前提下，提升代码可读性，降低程序员认知负担，使得后续维护和扩展更方便。捕获需求阶段不过度考虑优化设计。因为第一，不确定的需求，不提前做优化设计。第二，即使是比较确定的需求，如果后续修改可能性比较小也没必要过度优化设计。我的经验是，如果代码不是很难理解，可以容忍他上生产环境，接受一波来自用户的检验后，再思考如何优化设计。</p>
<p>设计糟糕的代码会让你的同事难受</p>
<p>一个团队一起工作，一些基本的设计原则要遵守的，一个团队最好要使用同一种框架来做事，因为每个人都不可能维持一年365天24小时可用，分分钟都有可能要求别的同事去改你的代码，如果你的代码让人很难读懂，那么他只能在你休假的时候打电话去打扰你了，这样大家都不好过。所以代码上线后，也不要忘了持续优化设计。</p>
<p>可读性 &gt; 性能</p>
<p>长期来看，几乎所有的代码都是要改的。容易被读懂的代码更容易被修改而得到性能优化。性能优化要如果没有数量级的变化就不知道为它牺牲可读性。因为硬件性能一直以摩尔定律的速度提升，所有的软件不做任何改变都能从硬件升级中获得红利。</p>
<p>测试防护网是一切的基本</p>
<p>既然代码注定要被多次修改，那么如何保证不破坏原有功能呢？答案只有一个：自动化测试。我们常说为了短期快速完成而走的临时方案是技术负债，长期来看，几乎所有的代码在刚刚诞生的那一刻都是负债。那么有没有什么代码在他诞生的一刻就是资产呢？如果有，我觉得就是自动化测试。只要代码后续还需要改，自动化测试就是保障我们不改出毛病的保障。设计良好的自动化测试，无疑会占据我们的开发时间，但它能保证我们的进步都是可叠加的。结硬寨，打呆仗。这是我喜欢的做事哲学。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/10/SaaS%E8%A1%8C%E4%B8%9A%E6%BC%8F%E6%96%97%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Warren Wu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Warren's Blog">
      <meta itemprop="description" content="code, architecture, engineering">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Warren's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/10/SaaS%E8%A1%8C%E4%B8%9A%E6%BC%8F%E6%96%97%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">SaaS行业漏斗模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-10 17:44:23" itemprop="dateCreated datePublished" datetime="2022-10-10T17:44:23+08:00">2022-10-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-10 19:03:35" itemprop="dateModified" datetime="2023-09-10T19:03:35+08:00">2023-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>SaaS行业的漏斗模型无非如下：</p>
<blockquote>
<p>接触-&gt;注册-&gt;使用-&gt;留存-&gt;订阅-&gt;续费</p>
</blockquote>
<p>现在流行的增长黑客方法是</p>
<ul>
<li><p>度量每一步转化过程的转化概率</p>
</li>
<li><p>提出每一步可能提升转化的方案</p>
</li>
<li><p>使用A&#x2F;B测试验证方案</p>
</li>
<li><p>上线经过验证的方案</p>
</li>
<li><p>重复以上循环</p>
</li>
</ul>
<p>这种数据驱动的模式已经比过去依靠天才顶层设计和拍脑袋的方式成功率高出不少，但是能否进一步升级这种模式？我觉得这种模式最大的缺陷是，除了数据度量可以自动化之外，每一步都需要人工介入</p>
<p>人工介入存在以下问题</p>
<ul>
<li><p>反馈迭代周期长</p>
</li>
<li><p>人工介入就不可避免认知偏误带来的问题</p>
</li>
<li><p>不可能给出太复杂的模型</p>
</li>
</ul>
<p>最后一点重点解释一下。有没有想过为啥是以上6步转化呢？为什么不是60步呢？为什么是一条线型漏斗模型，而不是一个马尔可夫状态转移矩阵？事实上如果用户在应用内的每一次点击都算的话，肯定是远远不止6步，付费路径也肯定有无数种可能。说到底其实都是因为人脑容量有限，不可能给出过度复杂的模型。但做过机器学习的都知道太简单的模型不可能做出好的效果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Warren Wu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.3.0/mermaid.min.js","integrity":"sha256-9y71g5Lz/KLsHjB8uXwnkuWDtAMDSzD/HdIbqhJfTAI="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
